
<p-dialog 
        header="{{selectedUser ? 'Editar Usuário' : 'Cadastrar Usuário'}}" 
        [(visible)]="displayAddEditModal" 
        [modal]="true" 
        [style]="{ width: '50vw', height: '75vw' }"
        [draggable]="false"
        [resizable]="false"
        (onHide)="onCloseModal()"
>
    <form [formGroup]="userForm" class="p-fluid">
        <div class="field">
            <label for="email" class="block text-900 font-medium mb-2">Email *</label>
            <input 
                type="email" 
                pInputText 
                formControlName="email" 
                class="w-full" 
                name="email" 
                placeholder="exemplo@email.com"
                [class.ng-invalid]="email.invalid && (email.dirty || email.touched)"
            />
            <small *ngIf="email.invalid && (email.dirty || email.touched)" class="block p-error mt-1">
                <div *ngIf="email.errors?.['required']">Email é obrigatório</div>
                <div *ngIf="email.errors?.['email']">Informe um email válido</div>
            </small>
        </div>
        
        <div class="field">
            <label for="name" class="block text-900 font-medium mb-2">Nome *</label>
            <input 
                type="text" 
                pInputText 
                formControlName="name" 
                class="w-full" 
                name="name"
                placeholder="Nome completo"
                [class.ng-invalid]="name.invalid && (name.dirty || name.touched)"
            />
            <small *ngIf="name.invalid && (name.dirty || name.touched)" class="block p-error mt-1">
                <div *ngIf="name.errors?.['required']">Nome é obrigatório</div>
                <div *ngIf="name.errors?.['minlength']">Nome deve ter pelo menos 2 caracteres</div>
            </small>
        </div>
        
        <div class="field">
            <label for="telefone" class="block text-900 font-medium mb-2">Telefone *</label>
            <input 
                type="tel" 
                pInputText 
                formControlName="telefone" 
                class="w-full" 
                name="telefone"
                placeholder="(11) 99999-9999"
                (input)="onPhoneInput($event)"
                [class.ng-invalid]="telefone.invalid && (telefone.dirty || telefone.touched)"
            />
            <small *ngIf="telefone.invalid && (telefone.dirty || telefone.touched)" class="block p-error mt-1">
                <div *ngIf="telefone.errors?.['required']">Telefone é obrigatório</div>
                <div *ngIf="telefone.errors?.['pattern']">Formato: (11) 99999-9999</div>
            </small>
        </div>
        
        <div class="field">
            <label for="cpforcnpj" class="block text-900 font-medium mb-2">CPF ou CNPJ *</label>
            <input 
                type="text" 
                pInputText 
                formControlName="cpforcnpj" 
                class="w-full" 
                name="cpforcnpj"
                placeholder="000.000.000-00 ou 00.000.000/0000-00"
                (input)="onDocumentInput($event)"
                [class.ng-invalid]="cpforcnpj.invalid && (cpforcnpj.dirty || cpforcnpj.touched)"
            />
            <small *ngIf="cpforcnpj.invalid && (cpforcnpj.dirty || cpforcnpj.touched)" class="block p-error mt-1">
                <div *ngIf="cpforcnpj.errors?.['required']">CPF ou CNPJ é obrigatório</div>
                <div *ngIf="cpforcnpj.errors?.['minlength']">CPF/CNPJ deve ter pelo menos 11 dígitos</div>
            </small>
        </div>
        
        <div class="field">
            <label for="department" class="block text-900 font-medium mb-2">Departamento *</label>
            <p-dropdown 
                [options]="departments" 
                formControlName="department" 
                placeholder="Selecione um departamento"
                class="w-full"
                [class.ng-invalid]="department.invalid && (department.dirty || department.touched)"
            />
            <small *ngIf="department.invalid && (department.dirty || department.touched)" class="block p-error mt-1">
                Departamento é obrigatório
            </small>
        </div>
    </form>
      <ng-template pTemplate="footer">
                <p-button 
                    label="Cancel" 
                    severity="danger" 
                    (click)="onCloseModal()" />
                <p-button 
                    label="Salvar" 
                    severity="success"
                    [disabled]="userForm.invalid"
                    (click)="onSaveUser()" 
                  />
    </ng-template>
</p-dialog>
<p-toast />

